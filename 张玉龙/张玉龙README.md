# 作业（2）李玉堂学长的“简单”虚拟机

### 背景：

​	学员：张玉龙2019211139

​	编程环境：pycharm，window10

​	时间：7/12 6:27 ~ 20:20 实际花费约4h

### 完成功能：

​		level1	 实现一个简易的虚拟机

​		level2	提升

​		leverl3	附加功能（文件输入/出，其他计算功能）

​		level4	二进制补码计算（只完成10进制转换为2进制，存在bug和未完成部分）

### 完成模拟指令集（不算pop等基本指令）

| 指令名 | 输入形式  | 功能                              |
| ------ | --------- | --------------------------------- |
| +      | A B order | A+B                               |
| -      | A B order | A-B                               |
| *      | A B order | A*B                               |
| /      | A B order | A/B                               |
| %      | A B order | A%B                               |
| file   | order     | 文件输入/输出，只读和写入两种模式 |
| trunc  | A order   | 取整数                            |
| fabs   | A order   | 取绝对值，返回float               |
| eq     | A B order | 验证是否相等，返回布尔值          |
| swap   | A B order | 栈内A,B位置交换                   |
| over   | A B order | A B A                             |
| drop   | order     | 栈去掉一个末尾元素                |



### 思路：

1.用类构建虚拟机，以列表变量作为寄存器和栈

2.将四则运算数值压入栈，根据指令得到新的值，栈内数值出栈，将新的值即所求值压入栈并输出

3.创建列表，并在每个数据发生流动和指令被调用时根据流动类型和增加列表元素，指令完成后输出列表个元素

```
def push(self, value):
    self.stack.append(value)
    self.data_movenent.append("数据从寄存器入栈")
```

4.根据python函数编写函数，编辑出部分计算指令（放弃copy大部分教程内的指令），文件输入/输出指令和栈内元素处理指令

```
def file(self):
    addr = input("请输入文件地址：")
    model = input("请输入模式：（w,r）")
    file0 = open(addr, model)
    if model == "w":
        content = input("请输入写入内容： ")
        file0.write(content)
        file0.close()
    elif model == "r":
        content = file0.read
        print(content)
```

5.实现level4，将数值转换为二进制计算再转为十进制输出。

​	5.思路一：利用网上python模块库直接计算。

​	5.思路二：

​					1.将数值用短除法（循环）转换成由0和1组成的二进制列表/用bin函数转换成二进指字符串，再将字符串转换成整数列表。

​					2.将整数列表转化为补码形式，依然是列表、

​					3.利用补码计算得出值，依然是列表

​					4.列表依次根据下标乘以2的次方，并相加，将列表转换为一个整数，输出即为所求。



### 缺陷和问题：

1. 输入格式比较僵化，不符合一般人习惯
2. 因为时间因素。部分指令防错机制不完善，如果输入格式不对，会报错而不是提醒错误后再来一次
3. 指令集不够多



### Bugs：

​	level4的二进制转换计算思路应该可行，但时间不足，只写了一部分，实际上处于无法正常使用的状态。使用后报错或得到的值不规范



