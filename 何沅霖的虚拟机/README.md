#### 方向： 李玉堂学长的“简单”虚拟机

#### 测试环境：CLion 2019.2 ，win10x64

(src中只有源码，若要用CLion测试请使用同目录下含有cmake等配置的VM(clion版).zip。)

#### 语言：C++

#### 实现功能：

​	1.Level 1 实现一个简易的虚拟机。

​	2.Level 2 提升。

​	3.Level 3 附加功能中的其他计算功能（按位异或，按位与，按位非），模拟内存。

#### 介绍：

​	1.虚拟机功能：运行和调试。(调试即为打印程序运行时指令调用顺序和数据流向)

​	2.虚拟机指令：

| 指令   | 功能描述                                                     |
| :----- | ------------------------------------------------------------ |
| HEL    | 程序结束标志                                                 |
| PUT    | 数据存储：接受两个数据或指令，第一个指令判断数据来源。若为外部，则第二个指令为输入数据类型。若为内部，则第二个数据为十进制数值。 |
| MOV    | 数据交换：接受两个数据，分别为需要交换数据所在寄存器的名称。 |
| ADD    | 第零个寄存器(axi)和第一个寄存器(bxi)相加，并存入第零个寄存器(axi)。 |
| SUB    | 第零个寄存器(axi)和第一个寄存器(bxi)相减，并存入第零个寄存器(axi)。 |
| DIV    | 第零个寄存器(axi)和第一个寄存器(bxi)相除，并存入第零个寄存器(axi)。 |
| MUL    | 第零个寄存器(axi)和第一个寄存器(bxi)相乘，并存入第零个寄存器(axi)。 |
| XOR    | 第零个寄存器(axi)和第一个寄存器(bxi)相按位异或，并存入第零个寄存器(axi)。 |
| OR     | 第零个寄存器(axi)和第一个寄存器(bxi)相按位或，并存入第零个寄存器(axi)。 |
| AND    | 第零个寄存器(axi)和第一个寄存器(bxi)相按位与，并存入第零个寄存器(axi)。 |
| NOT    | 第零个寄存器(axi)自身按位取反，并存入第零个寄存器(axi)。     |
| JEP    | 条件跳转：接受三个数据，第一个为待比较值所在寄存器的名称，第二个值为固定的比较值，第三个为跳转长度。若两者相等，则跳转到指定长度。若不相等，则跳转到下一指令。 |
| JNEP   | 条件跳转：接受三个数据，第一个为待比较值所在寄存器的名称，第二个值为固定的比较值，第三个为跳转长度。若两者不相等，则跳转到指定长度。若不相等，则跳转到下一指令。 |
| JGP    | 条件跳转：接受三个数据，第一个为待比较值所在寄存器的名称，第二个值为固定的比较值，第三个为跳转长度。若前者大于后者，则跳转到指定长度。若不相等，则跳转到下一指令。 |
| JGEP   | 条件跳转：接受三个数据，第一个为待比较值所在寄存器的名称，第二个值为固定的比较值，第三个为跳转长度。若前者大于等于后者，则跳转到指定长度。若不相等，则跳转到下一指令。 |
| JLP    | 条件跳转：接受三个数据，第一个为待比较值所在寄存器的名称，第二个值为固定的比较值，第三个为跳转长度。若前者小于后者，则跳转到指定长度。若不相等，则跳转到下一指令。 |
| JLEP   | 条件跳转：接受三个数据，第一个为待比较值所在寄存器的名称，第二个值为固定的比较值，第三个为跳转长度。若前者小于等于后者，则跳转到指定长度。若不相等，则跳转到下一指令。 |
| JMP    | 无条件跳转：接受一个数据，数据为跳转长度。                   |
| OUT    | 输出：接受一个指令和一个数据。第一个指令为输出数据类型。第二个数据为输出数据所在的寄存器名字。 |
| inst_c | 计数，不做指令集。                                           |

3.其他：

​	寄存器名称: axi bxi cxi dxi exi fxi gxi hxi 。(只有8个)

​	PUT 的输入来源指令为名称 D_OUT 和 D_IN ，外部输入数据类型指令名称为 _char 和 _digit。

​	OUT输出数据类型指令名称为_char 和 _digit，和PUT共用。

##### 注意：

​		1.所有条件跳转比较值均为数字，字符为对应的ascii码。

​		2.只有无条件跳转才可以往上跳转，即跳转长度为负数，其他条件跳转的跳转长度只能为正数。

#### 跳转长度计算：

​	无论是条件跳转还是无条件跳转，都以 <u>跳转长度的数据的所在位置</u> 为基础，计算与目标指令之间的间隔数再加上2即为 <u>跳转长度的绝对值</u> 。若向上跳转，则无条件跳转的 <u>跳转长度</u> 为负，反之为正。

例如：

```
JMP , 7 ,
JEP , cxi , int('&') , 6 ,
AND ,
OUT , axi , _digit,
HEL
```

无条件跳转长度的数据 *7* 与目标指令 *OUT* 之间间隔 *CJP  cxi  38  5 AND* 这5个指令数据，那么，无条件跳转长度即为 5+2=7.

同理条件跳转长度的数据 *6* 与目标指令 *HEL* 之间间隔 *AND OUT  axi*  *_digit*  这4个指令数据，那么，条件跳转长度即为 4+2=6.

#### 测试示例使用方法：

进入bin目录，打开VM.exe。

按提示输入1或2。

输入 1+2  。(支持“+ - * / | ^ &”)

出结果。



