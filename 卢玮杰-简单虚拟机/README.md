# 红岩暑假作业

## 简单虚拟机

**环境**：GNU GCC编译 win10

**语言**：c++不过其实只用了c的功能



**完成程度**

因为没有过程调用就没用堆栈

基本是一边看csapp一边写，没搜到算术操作怎么设置条件码所以也没做出来

只能用cmp和test设置

用二进制实现补码四则运算，取模，位运算。

实现了条件跳转和条件转移。

| 指令   | 编号 | 功能            |
| ------ | ---- | --------------- |
| ret    | 00   | 程序结束        |
| print  | 01   | 打印十进制值    |
| bprint | 02   | 打印二进制值    |
| cmp    | 03   | 比较设置条件码  |
| jmp    | 04   | 直接跳转        |
| je     | 05   | 相等/零跳转     |
| jne    | 06   | 不相等/非零跳转 |
| jg     | 07   | 大于跳转        |
| jge    | 08   | 大于等于跳转    |
| jl     | 09   | 小于跳转        |
| jle    | 10   | 小于等于跳转    |
| cmov   | 11   | 直接传送        |
| cmove  | 12   | 相等/零传送     |
| cmovne | 13   | 不相等/非零传送 |
| cmovg  | 14   | 大于传送        |
| cmovge | 15   | 大于等于传送    |
| cmovl  | 16   | 小于传送        |
| cmovle | 17   | 小于等于传送    |
| neg    | 18   | 取负            |
| add    | 19   | 加              |
| isub   | 20   | 减              |
| imul   | 21   | 乘              |
| idiv   | 22   | 整数除          |
| mod    | 23   | 取模            |
| bxor   | 24   | 按位异或        |
| bor    | 25   | 按位或          |
| band   | 26   | 按位与          |
| test   | 27   | 测试设置条件码  |
| sal    | 28   | 左移            |
| sar    | 29   | 算术右移        |
| shr    | 30   | 逻辑右移        |



**使用**

输入时命令数据之间用大于一个的空格隔开

数据分为$立即数，%寄存器，&内存引用

指定寄存器与内存地址时分别取低4位/低7位 所以可以用负数作为地址，比如Register[15]=Register[-1]

读到ret时会结束读入

cmov  $4 %0

cmov  $0 %1

add     $1 %1

cmp    %0 %1

jg         2

ret

大概就是这个格式

然后会输出

00	11  $4 %0

01	11  $0 %1

02	19     $1 %1

03	03    %0 %1

04	07        2

02	19     $1 %1

03	03    %0 %1

04	07        2

02	19     $1 %1

03	03    %0 %1

04	07        2

02	19     $1 %1

03	03    %0 %1

04	07        2

05    00



**已知的bug**

已知的都改了，但是没有防弹也没做很多测试估计bug挺多







